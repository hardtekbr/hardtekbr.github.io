!function(t){function e(t,e,o){return a(t,e+"="+o)}function a(t,e){return t+(t.indexOf("?")<0?"?":"&")+e}function o(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];if("boolean"==typeof a)return a;if("string"==typeof a){var o=t.attr(a);if(o){if("true"===o.toLowerCase())return!0;if("false"===o.toLowerCase())return!1}}}}t.modalLinkDefaults={height:600,width:900,showTitle:!0,showClose:!0,overlayOpacity:.6,method:"GET",disableScroll:!0,onHideScroll:function(){},onShowScroll:function(){}};var i={init:function(e){var a=t.extend({},t.modalLinkDefaults);return t.extend(a,e),this.each(function(){var e=t(this);e.hasClass("sparkling-modal-link")||(e.addClass("sparkling-modal-link"),e.click(function(t){return t.preventDefault(),i.open(e,a),!1}))})},close:function(e){var a=t(".sparkling-modal-container"),o=a.data("modallink");if(o){o.trigger("modallink.close");var i=a.find(".sparkling-modal-overlay"),n=a.find(".sparkling-modal-frame");i.fadeTo("fast",0),n.fadeTo("fast",0,function(){a.remove(),function(e){var a=t("body"),o=a.outerWidth();a.css({width:"",overflow:""});var i=a.outerWidth();"function"==typeof e&&e(o-i)}(e),"function"==typeof e&&e()})}},open:function(n,l){var r,d,s,c,f;r=(l=l||{}).url||n.attr("href"),d=l.title||n.attr("data-ml-title")||n.attr("title")||n.text(),s=o(n,l.showTitle,"data-ml-show-title",t.modalLinkDefaults.showTitle),c=o(n,l.showClose,"data-ml-show-close",t.modalLinkDefaults.showClose),f=o(n,l.disableScroll,"data-ml-disable-scroll",t.modalLinkDefaults.disableScroll);var p=t.extend({},t.modalLinkDefaults);t.extend(p,l);var m=n.attr("data-ml-width");m&&(p.width=parseInt(m));var h=n.attr("data-ml-height");h&&(p.height=parseInt(h)),"CLONE"!==p.method&&r.length>0&&"#"===r[0]&&(p.method="REF"),"GET"!=p.method&&"POST"!=p.method||(r=e(r,"__inmodal","true"));var u={};void 0!==p.data&&(u="function"==typeof p.data?p.data():p.data);var v=t('<div class="sparkling-modal-container"></div>');v.data("modallink",n);var y=t('<div class="sparkling-modal-overlay"></div>');y.css({position:"fixed",top:0,left:0,opacity:0,width:"100%",height:"100%",zIndex:999}),y.appendTo(v);var k=t('<div class="sparkling-modal-frame"></div>').css("opacity",0).css({zIndex:1e3,position:"fixed",display:"inline-block"}).css({left:"50%",marginLeft:-p.width/2}).css({top:"50%",marginTop:-p.height/2}).appendTo(v);if(t("body").append(v),s){var g=t('<div class="sparkling-modal-title"></div>');if(g.appendTo(k),g.append(t("<span></span>").html(d)),c){var w=t("<div class=\"sparkling-modal-close\"><div class='i-close'><div class='i-close-h' /><div class='i-close-v' /></div></div>");w.appendTo(g),w.click(i.close)}g.append('<div style="clear: both;"></div>')}var T,b=t('<div class="sparkling-modal-content"></div>');if(b.appendTo(k),"REF"==p.method){(T=t("<div />")).css("overflow","auto");var L=t(r),x="ref_"+(new Date).getTime(),C=t("<div id='"+x+"' />");C.insertAfter(L),L.appendTo(T),n.on("modallink.close",function(){C.replaceWith(L)})}else T=t("<iframe frameborder=0 id='modal-frame' name='modal-frame'></iframe>");if(T.appendTo(b),T.css({width:p.width,height:p.height}),"CLONE"==p.method){console.log(r);var S=t(r);console.log(S);var D=T[0].contentDocument||T[0].contentWindow.document;D.write(S.html()),D.close()}else if("GET"==p.method){if("object"==typeof u)for(var O in u)u.hasOwnProperty(O)&&(r=e(r,O,u[O]));else void 0!==u&&(r=a(r,u));T.attr("src",r)}if(k.css({marginTop:-k.outerHeight(!1)/2}),y.fadeTo("fast",p.overlayOpacity),k.fadeTo("fast",1),"POST"==p.method){var j=p.$form;if(j&&j instanceof jQuery){j.attr("target");j.attr("target","modal-frame").data("submitted-from-modallink",!0).submit()}else{if(j=t("<form />").attr("action",r).attr("method","POST").attr("target","modal-frame").css({display:"none"}),t("<input />").attr({type:"hidden",name:"__sparklingModalInit",value:1}).appendTo(j),t.isArray(u))for(var O in u)t("<input />").attr({type:"hidden",name:u[O].name,value:u[O].value}).appendTo(j);else for(var O in u)t("<input />").attr({type:"hidden",name:O,value:u[O]}).appendTo(j);j.appendTo("body").submit(),j.remove()}}f&&function(e){var a=t("body").outerWidth();t("body").css({overflow:"hidden"});var o=t("body").outerWidth();t("body").css({width:a}),"function"==typeof e&&e(o-a)}(p.onHideScroll)}};t.fn.modalLink=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.modalLink"),this):i.init.apply(this,arguments)},t.modalLink=function(e){return i[e]?i[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.modalLink"),this):i.init.apply(this,arguments)},t.modalLink.open=function(e,a){(a=t.extend({},a)).url=e,i.open.call(this,t("<a />"),a)}}(jQuery),$(document).keyup(function(t){27==t.keyCode&&$.modalLink("close")});